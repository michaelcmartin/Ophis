<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>The stack</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
TITLE="Programming with Ophis"
HREF="book1.html"><LINK
REL="UP"
TITLE="Structured Programming"
HREF="c711.html"><LINK
REL="PREVIOUS"
TITLE="Structured Programming"
HREF="c711.html"><LINK
REL="NEXT"
TITLE="Procedures and register saving"
HREF="x771.html"></HEAD
><BODY
CLASS="SECTION"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>Programming with Ophis</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="c711.html"
ACCESSKEY="P"
>&#60;&#60;&#60; Previous</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
>Structured Programming</TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="x771.html"
ACCESSKEY="N"
>Next &#62;&#62;&#62;</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECTION"
><H1
CLASS="SECTION"
><A
NAME="AEN765"
>The stack</A
></H1
><P
>    The 6502 has an onboard stack in page 1.  You can modify the stack
    pointer by storing values in X register and
    using <TT
CLASS="LITERAL"
>txs</TT
>; an <SPAN
CLASS="QUOTE"
>"empty"</SPAN
> stack is
    value $FF.  Going into a procedure pushes the address of the next
    instruction onto the stack, and RTS pops that value off and jumps
    there.  (Well, not precisely.  JSR actually pushes a value that's
    one instruction short, and RTS loads the value, increases it by
    one, and THEN jumps there.  But that's only an issue if you're
    using RTS to implement jump tables.)  On an interrupt, the next
    instruction's address is pushed on the stack, then the process
    flags, and it jumps to the handler.  The return from interrupt
    restores the flags and the PC, just as if nothing had
    happened.
  </P
><P
>    The stack only has 256 possible entries; since addresses take two
    bytes to store, that means that if you call something that calls
    something that calls something that (etc., etc., 129 times), your
    computation will fail.  This can happen faster if you save
    registers or memory values on the stack (see below).
  </P
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="c711.html"
ACCESSKEY="P"
>&#60;&#60;&#60; Previous</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="book1.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="x771.html"
ACCESSKEY="N"
>Next &#62;&#62;&#62;</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Structured Programming</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="c711.html"
ACCESSKEY="U"
>Up</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Procedures and register saving</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>